(window.webpackJsonp=window.webpackJsonp||[]).push([[46],{103:function(e,t,n){"use strict";n.r(t),n.d(t,"frontMatter",(function(){return r})),n.d(t,"metadata",(function(){return c})),n.d(t,"rightToc",(function(){return l})),n.d(t,"default",(function(){return s}));var a=n(2),o=n(6),i=(n(0),n(137)),r={id:"configuration",title:"Project Configuration",sidebar_label:"Project Configuration"},c={unversionedId:"configuration",id:"configuration",isDocsHomePage:!1,title:"Project Configuration",description:"Adding project configuration",source:"@site/docs/configuration.md",slug:"/configuration",permalink:"/docs/docs/configuration",editUrl:"https://github.com/nimbella/docs/edit/master/docs/configuration.md",version:"current",sidebar_label:"Project Configuration",sidebar:"someSidebar",previous:{title:"Nimbella Project",permalink:"/docs/docs/project"},next:{title:"Deployer Feature",permalink:"/docs/docs/deployerFeature"}},l=[{value:"Adding project configuration",id:"adding-project-configuration",children:[{value:"Project configuration for packages and actions",id:"project-configuration-for-packages-and-actions",children:[]},{value:"Project configuration for web content",id:"project-configuration-for-web-content",children:[]},{value:"Symbolic variables",id:"symbolic-variables",children:[]},{value:"File substitution",id:"file-substitution",children:[]},{value:"Dictionary substitution",id:"dictionary-substitution",children:[]}]}],b={rightToc:l};function s(e){var t=e.components,n=Object(o.a)(e,["components"]);return Object(i.b)("wrapper",Object(a.a)({},b,n,{components:t,mdxType:"MDXLayout"}),Object(i.b)("h2",{id:"adding-project-configuration"},"Adding project configuration"),Object(i.b)("p",null,"A feature that sets nim projects apart from many other deployment tools is that no manifest or configuration file is required in a large number of suitably simple cases. You can simply choose a directory in the file system to represent a project and lay out the content of the project under that directory using a structure that nim will recognize as a project. See ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/docs/singleAction"}),"the no-configuration project example"),"."),Object(i.b)("p",null,"However, Nimbella projects can\u2019t always avoid having a configuration file, so this section summarizes how to add a configuration file to guide nim when the file and directory structure doesn\u2019t convey everything it needs to know."),Object(i.b)("p",null,"To configure a project, create a configuration file called ",Object(i.b)("em",{parentName:"p"},"project.yml")," in the project\u2019s root directory. The configuration file is coded in YAML. There are various online tutorials for YAML if you need to learn more about the YAML language."),Object(i.b)("p",null,"One important fact about YAML is that things to the right of the ",Object(i.b)("inlineCode",{parentName:"p"},":")," separator are given data types according to their appearance.  So, ",Object(i.b)("inlineCode",{parentName:"p"},"7895.37")," is taken to be a ",Object(i.b)("em",{parentName:"p"},"number")," and not a string, even though ",Object(i.b)("inlineCode",{parentName:"p"},"abcd.ef")," would be parsed as a string. You can always cause values to be taken as strings by quoting them.  E.g. ",Object(i.b)("inlineCode",{parentName:"p"},'"7895.37"')," and ",Object(i.b)("inlineCode",{parentName:"p"},'"abcd.ef"')," are both strings.  This distinction can be important in cases when dot-separated alphameric values can end up looking like numbers by the accident of having only digits and dots."),Object(i.b)("p",null,"The structure of the information in the ",Object(i.b)("em",{parentName:"p"},"project.yml")," file should follow the structure of the project itself.  If you create the project using ",Object(i.b)("inlineCode",{parentName:"p"},"nim project create")," you can optionally request a ",Object(i.b)("em",{parentName:"p"},"project.yml")," to be generated from the start, giving you something to edit."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"> nim project create example6 --config\n")),Object(i.b)("p",null,"The resulting project will have a ",Object(i.b)("em",{parentName:"p"},"project.yml")," with all default values."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"targetNamespace: ''\ncleanNamespace: false\nbucket: {}\nparameters: {}\nenvironment: {}\npackages:\n  - name: default\n    shared: false\n    clean: false\n    environment: {}\n    parameters: {}\n    annotations: {}\n    actions:\n      - name: hello\n        clean: false\n        binary: false\n        main: ''\n        runtime: 'nodejs:default'\n        web: true\n        webSecure: false\n        parameters: {}\n        environment: {}\n        annotations: {}\n        limits: {}\n")),Object(i.b)("p",null,"All of the properties in these examples will be explained below.  You can also hand-edit ",Object(i.b)("em",{parentName:"p"},"project.yml")," from scratch but having an all-defaults template to start from can be helpful."),Object(i.b)("p",null,"The project configuration is merged with what is inferred from file and directory names, so it\u2019s only necessary to put information in the configuration that can\u2019t be inferred from file or directory names or for which the defaults aren\u2019t what you want.  If you generate your ",Object(i.b)("em",{parentName:"p"},"project.yml")," using ",Object(i.b)("inlineCode",{parentName:"p"},"nim project create"),", you can remove entries that denote defaults without changing the subsequent behavior."),Object(i.b)("p",null,"We\u2019ll cover configuration for packages and actions first, then configuration for web content, including an example of generated content such as a React web app. Then we\u2019ll cover symbolic variables and file substitution."),Object(i.b)("h3",{id:"project-configuration-for-packages-and-actions"},"Project configuration for packages and actions"),Object(i.b)("p",null,"Let\u2019s suppose that in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/docs/singleAction"}),"the example1 project"),", you don\u2019t want ",Object(i.b)("inlineCode",{parentName:"p"},"hello")," to be a web action and the deployer cannot determine its main entry point directly from the code. Add a ",Object(i.b)("em",{parentName:"p"},"project.yml")," file such as the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"packages:\n  - name: demo\n    actions:\n      - name: hello\n        web: false\n        main: myMain\n")),Object(i.b)("p",null,"The following sections contain a list of configuration members for ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#action-modifiers-allowed-in-project-yml"}),"actions"),", ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#package-modifiers-allowed-in-project-yml"}),"packages"),", and ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#global-modifiers-allowed-in-project-yml"}),"global"),". An additional configuration member is ",Object(i.b)("inlineCode",{parentName:"p"},"bucket")," which is documented in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/docs/webContent"}),"Adding static web content"),"."),Object(i.b)("h4",{id:"action-modifiers-allowed-in-projectyml"},"Action modifiers allowed in project.yml"),Object(i.b)("p",null,"Here are the action modifiers that are allowed in the configuration."),Object(i.b)("h5",{id:"web"},"web"),Object(i.b)("p",null,"May be ",Object(i.b)("inlineCode",{parentName:"p"},"true"),", ",Object(i.b)("inlineCode",{parentName:"p"},"false")," or ",Object(i.b)("inlineCode",{parentName:"p"},"raw"),". The default is ",Object(i.b)("inlineCode",{parentName:"p"},"true"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"web")," modifier has the same semantics as it does in ",Object(i.b)("inlineCode",{parentName:"p"},"nim action create"),", except for the default. The value ",Object(i.b)("inlineCode",{parentName:"p"},"yes")," or ",Object(i.b)("inlineCode",{parentName:"p"},"true")," produces a normal web action. The value ",Object(i.b)("inlineCode",{parentName:"p"},"no")," or ",Object(i.b)("inlineCode",{parentName:"p"},"false")," produces an action that is not a web action. The value ",Object(i.b)("inlineCode",{parentName:"p"},"raw")," produces a raw HTTP web action. The default is ",Object(i.b)("inlineCode",{parentName:"p"},"true")," if not specified. These behaviors are accomplished via annotations with reserved meanings that are merged with annotations provided by you."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," See also the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#web-1"}),Object(i.b)("inlineCode",{parentName:"a"},"web"))," modifier on packages."),Object(i.b)("h5",{id:"runtime"},"runtime"),Object(i.b)("p",null,'The runtime to use for the action. It should be in the form "language:version", for example "python:3" or "language:default", for example "go:default". Because of the colon, the string should be quoted, as in these examples.'),Object(i.b)("h5",{id:"main"},"main"),Object(i.b)("p",null,"The main entry point for the action."),Object(i.b)("h5",{id:"binary"},"binary"),Object(i.b)("p",null,"May be true or false. The value true indicates the need for base64 encoding when transmitting the action for deployment. Normally this is inferred from the file suffix."),Object(i.b)("h5",{id:"websecure"},"webSecure"),Object(i.b)("p",null,"Note that web actions are normally executable by anyone.  Adding the ",Object(i.b)("inlineCode",{parentName:"p"},"webSecure")," flag secures a web action in one of two ways.  If a string value is provided, that string is taken to be a secret that must be provided by invokers of the action.  If the boolean value ",Object(i.b)("inlineCode",{parentName:"p"},"true")," is provided, then only users who have valid Nimbella authorization, and provide that authorization in a basic authentication header when invoking the action, will be able to invoke the action.  The value ",Object(i.b)("inlineCode",{parentName:"p"},"false")," requests the default behavior for web actions (anyone can execute)."),Object(i.b)("h5",{id:"annotations"},"annotations"),Object(i.b)("p",null,"A nested map providing annotations to place on the action."),Object(i.b)("p",null,"The keys and values of annotations are up to you to create. The important thing is that both clauses are nested maps in YAML terms and can have as many keys and values as needed. See the example in the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"parameters"))," description."),Object(i.b)("h5",{id:"parameters"},"parameters"),Object(i.b)("p",null,"A nested map providing parameters, which are bound to the action and passed on each invocation."),Object(i.b)("p",null,"The keys and values of parameters are up to you to create. The important thing is that both clauses are nested maps in YAML terms and can have as many keys and values as needed.  The following example shows some key-value pairs created for the ",Object(i.b)("inlineCode",{parentName:"p"},"annotations")," and ",Object(i.b)("inlineCode",{parentName:"p"},"parameters")," modifiers for the ",Object(i.b)("inlineCode",{parentName:"p"},"hello")," action in the ",Object(i.b)("inlineCode",{parentName:"p"},"demo")," package."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"packages:\n  - name: demo\n    actions:\n      - name: hello\n        annotations:\n          final: true\n          sampleAction: true\n        parameters:\n          language: English\n")),Object(i.b)("h5",{id:"environment"},"environment"),Object(i.b)("p",null,"A nested map providing parameters that are placed in the environment of the action before each invocation"),Object(i.b)("h5",{id:"clean"},"clean"),Object(i.b)("p",null,"May be ",Object(i.b)("inlineCode",{parentName:"p"},"true")," or ",Object(i.b)("inlineCode",{parentName:"p"},"false"),", indicating whether you want any previous action with the same name to be removed before deploying a new one. The default is ",Object(i.b)("inlineCode",{parentName:"p"},"false"),"."),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"clean")," modifier requires some explanation. The deployer installs actions using the update verb, meaning that there is some history maintained in the installed action. The version number is incremented. Parameters and annotations from a previous incarnation will be retained unless changed. The code is always installed anew, however. The ",Object(i.b)("inlineCode",{parentName:"p"},"clean")," flag guarantees that the action is built only from the information in the project by erasing any old copy of the action before deploying the new one."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"See also the ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#clean-1"}),Object(i.b)("inlineCode",{parentName:"a"},"clean"))," flag on packages and the ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#cleannamespace"}),Object(i.b)("inlineCode",{parentName:"a"},"cleanNamespace"))," global flag."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flags on actions are ignored when the ",Object(i.b)("inlineCode",{parentName:"li"},"--incremental")," flag is specified."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flags on actions are also ignored when deployment of those actions is suppressed through the use of ",Object(i.b)("inlineCode",{parentName:"li"},"--include")," or ",Object(i.b)("inlineCode",{parentName:"li"},"--exclude")," flags on the command line.")),Object(i.b)("h5",{id:"limits"},"limits"),Object(i.b)("p",null,"A nested map in which you can set limits for"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"the timeout in milliseconds"),Object(i.b)("li",{parentName:"ul"},"memory in megabytes"),Object(i.b)("li",{parentName:"ul"},"log size in kilobytes")),Object(i.b)("p",null,"For example"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"packages:\n  - name: demo\n    actions:\n      - name: hello\n        limits:\n          timeout: 10000\n          logs: 10,\n          memory: 256,\n")),Object(i.b)("p",null,"You need not specify all limits if you only wish to specify one or two.  All three of these limits must be numbers and within the range permitted by the Nimbella cloud (use ",Object(i.b)("inlineCode",{parentName:"p"},"nim info --limits")," to see the allowed range).  When not specified, Nimbella Cloud defaults are assumed."),Object(i.b)("h5",{id:"localbuild"},"localBuild"),Object(i.b)("p",null,"If ",Object(i.b)("inlineCode",{parentName:"p"},"true"),", specifies that any build done for this action must be local (even if ",Object(i.b)("inlineCode",{parentName:"p"},"--remote-build")," is specified).  A request to build remotely will be ignored for this action.  A project containing such an action cannot be deployed from the workbench unless the action is excluded through use of the ",Object(i.b)("inlineCode",{parentName:"p"},"--exclude")," or ",Object(i.b)("inlineCode",{parentName:"p"},"--include")," flags.  It is illegal to set both this flag and the ",Object(i.b)("inlineCode",{parentName:"p"},"remoteBuild")," flag to ",Object(i.b)("inlineCode",{parentName:"p"},"true"),"."),Object(i.b)("h5",{id:"remotebuild"},"remoteBuild"),Object(i.b)("p",null,"If ",Object(i.b)("inlineCode",{parentName:"p"},"true"),", specifies that any build done for this action must be remote (regardless of whether ",Object(i.b)("inlineCode",{parentName:"p"},"--remote-build")," is specified).  It is good to specify this for actions whose build will be incorrect unless done in the environment of the runtime container.  It is illegal to set both this flag and the ",Object(i.b)("inlineCode",{parentName:"p"},"localBuild")," flag to ",Object(i.b)("inlineCode",{parentName:"p"},"true"),"."),Object(i.b)("h4",{id:"package-modifiers-allowed-in-projectyml"},"Package modifiers allowed in project.yml"),Object(i.b)("p",null,"The package modifiers that can go in the configuration are as follows."),Object(i.b)("h5",{id:"shared"},"shared"),Object(i.b)("p",null,"May be ",Object(i.b)("inlineCode",{parentName:"p"},"false")," (default) or ",Object(i.b)("inlineCode",{parentName:"p"},"true"),". It indicates that the contents of the package are accessible to other authorized users."),Object(i.b)("h5",{id:"annotations-1"},"annotations"),Object(i.b)("p",null,"A nested map providing annotations to place on the package."),Object(i.b)("p",null,"The keys and values of ",Object(i.b)("inlineCode",{parentName:"p"},"annotations")," are up to you to create. The important thing is that both clauses are nested maps in YAML terms and can have as many keys and values as needed. See the example in the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"parameters"))," modifier for actions."),Object(i.b)("h5",{id:"parameters-1"},"parameters"),Object(i.b)("p",null,"A nested map providing parameters to be bound to all of the actions of the package and passed on each invocation."),Object(i.b)("p",null,"The keys and values of ",Object(i.b)("inlineCode",{parentName:"p"},"parameters")," are up to you to create. The important thing is that both clauses are nested maps in YAML terms and can have as many keys and values as needed. See the example in the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#parameters"}),Object(i.b)("inlineCode",{parentName:"a"},"parameters"))," modifier for actions."),Object(i.b)("h5",{id:"environment-1"},"environment"),Object(i.b)("p",null,"A nested map providing parameters to be placed in the environment of all the actions of the package before each invocation."),Object(i.b)("h5",{id:"web-1"},"web"),Object(i.b)("p",null,"A ",Object(i.b)("inlineCode",{parentName:"p"},"web")," modifier to be distributed to all actions of the package that don't have their own ",Object(i.b)("inlineCode",{parentName:"p"},"web")," modifier.  The same values are accepted as on an action."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"A value of ",Object(i.b)("inlineCode",{parentName:"li"},"web: true")," is the same as omitting the modifier since that is the default."),Object(i.b)("li",{parentName:"ul"},"One use for this modifier is when it is not appropriate to make ",Object(i.b)("em",{parentName:"li"},"any")," actions of a package be web actions, both those that exist now and those you may add in the future.  Just put ",Object(i.b)("inlineCode",{parentName:"li"},"web: false")," on the package.")),Object(i.b)("h5",{id:"clean-1"},"clean"),Object(i.b)("p",null,"May be ",Object(i.b)("inlineCode",{parentName:"p"},"true")," or ",Object(i.b)("inlineCode",{parentName:"p"},"false"),", indicating whether you want any previous package with the same name and all of its contained actions to be removed before deploying a new one. The default is ",Object(i.b)("inlineCode",{parentName:"p"},"false"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},Object(i.b)("inlineCode",{parentName:"li"},"clean")," at the package level is not the same as specifying clean on each action of the package. At package level, the ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flag removes all actions from the package before deploying, even ones that are not being deployed by the present project. It also removes package parameters and annotations. The ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flag at the package level is only appropriate when you want the project to \u201cown\u201d a particular package outright. See also the ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#cleanactions"}),Object(i.b)("inlineCode",{parentName:"a"},"clean"))," flag on actions and the ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#cleannamespace"}),Object(i.b)("inlineCode",{parentName:"a"},"cleanNamespace"))," global flag."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flag on packages is ignored when the ",Object(i.b)("inlineCode",{parentName:"li"},"--incremental")," flag is specified."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flag on packages is also ignored when deployment of those packages is suppressed through the use of ",Object(i.b)("inlineCode",{parentName:"li"},"--include")," or ",Object(i.b)("inlineCode",{parentName:"li"},"--exclude")," flags on the command line.")),Object(i.b)("h4",{id:"global-modifiers-allowed-in-projectyml"},"Global modifiers allowed in project.yml"),Object(i.b)("p",null,"There are also some useful global members of the configuration."),Object(i.b)("h5",{id:"targetnamespace"},"targetNamespace"),Object(i.b)("p",null,"Establishes project ownership of namespaces for 'test' and 'production' use, as described in ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/docs/namespaceToProjects"}),"Tieing Namespaces to Projects"),".  The simpler form"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"targetNamespace: <myNamespace>\n")),Object(i.b)("p",null,"is also accepted for compatibility with earlier releases of ",Object(i.b)("inlineCode",{parentName:"p"},"nim"),".  It causes deployment to go by default to a given namespace but does not establish ownership."),Object(i.b)("h5",{id:"cleannamespace"},"cleanNamespace"),Object(i.b)("p",null,"May be ",Object(i.b)("inlineCode",{parentName:"p"},"true")," or ",Object(i.b)("inlineCode",{parentName:"p"},"false")," (default). It causes the entire namespace to be cleared of content prior to deployment: actions, package, and web content. Set this option to ",Object(i.b)("inlineCode",{parentName:"p"},"true")," only if you intend the project to have total ownership of the namespace.  It can be set initially in a new project using the ",Object(i.b)("inlineCode",{parentName:"p"},"--clean")," flag on ",Object(i.b)("inlineCode",{parentName:"p"},"nim project create"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"See also the ",Object(i.b)("inlineCode",{parentName:"li"},"clean")," flag on ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#cleanactions"}),"actions")," and ",Object(i.b)("a",Object(a.a)({parentName:"li"},{href:"#cleanpkgs"}),"packages"),"."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"cleanNamespace")," global flag is ignored when the ",Object(i.b)("inlineCode",{parentName:"li"},"--incremental")," flag is specified.")),Object(i.b)("h5",{id:"parameters-2"},"parameters"),Object(i.b)("p",null,'A nested map providing parameters to place on every "real" package in the project (those capable of accepting parameters).  The parameters are then distributed by the backend to all the actions that are contained in those packages.'),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:"),' The "default" package is not a package in the backend but simply contains the actions that are not in any package.  It is not legal to specify ',Object(i.b)("inlineCode",{parentName:"p"},"parameters")," for it and thus ",Object(i.b)("inlineCode",{parentName:"p"},"parameters")," at top level do not distribute to it."),Object(i.b)("h5",{id:"environment-2"},"environment"),Object(i.b)("p",null,'A nested map providing parameters to place on every "real" package in the project such that the parameters go into the environment of actions of the packages.'),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," See note under ",Object(i.b)("inlineCode",{parentName:"p"},"parameters"),"."),Object(i.b)("h3",{id:"project-configuration-for-web-content"},"Project configuration for web content"),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},"project.yml")," file can also contain configuration that controls how the web directory and web content is deployed."),Object(i.b)("h4",{id:"use-the-projectyml-bucket-member-to-configure-how-web-content-is-deployed"},"Use the project.yml bucket member to configure how web content is deployed"),Object(i.b)("p",null,"Adding a ",Object(i.b)("inlineCode",{parentName:"p"},"bucket")," member at the top level of ",Object(i.b)("em",{parentName:"p"},"project.yml")," provides several options for configuring deployment of your web content, as shown in the following example and described in the sections below. All entries are optional."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),'bucket:\n  prefixPath: "chatroom"\n  clean: true\n  mainPageSuffix: chatroom.html\n  notFoundPage: "error.html"\n  strip: 1\n  useCache: true\n  localBuild: true\n  remoteBuild: false\n')),Object(i.b)("p",null,"The following sections have a description of the ",Object(i.b)("inlineCode",{parentName:"p"},"bucket")," options shown in this example."),Object(i.b)("h5",{id:"share-a-nimbella-namespace-with-prefixpath"},"Share a Nimbella namespace with prefixpath"),Object(i.b)("p",null,"When ",Object(i.b)("inlineCode",{parentName:"p"},"https://<namespace>-host.nimbella.io")," is used as a URL with no additional path component, a path of ",Object(i.b)("em",{parentName:"p"},"/index.html")," is assumed, but if your web content doesn\u2019t require being placed at the root of the URL path space, you can allow web content from different projects to share a namespace and a hostname. This is done by using prefix paths to place each project\u2019s web content in a different location. The Nimbella deployer does not rewrite URLs internal to your content, but you can configure prefix paths by adding a ",Object(i.b)("inlineCode",{parentName:"p"},"prefixPath")," flag."),Object(i.b)("p",null,"The path specified in ",Object(i.b)("inlineCode",{parentName:"p"},"prefixpath")," is prepended to every URL path whenever resources are uploaded. For example, given the examples above, the resource ",Object(i.b)("em",{parentName:"p"},"chatroom.html")," would be deployed to ",Object(i.b)("inlineCode",{parentName:"p"},"https://<namespace>-host/chatroom/chatroom.html"),"."),Object(i.b)("h5",{id:"delete-previously-deployed-content-when-new-content-is-deployed"},"Delete previously deployed content when new content is deployed"),Object(i.b)("p",null,"If the ",Object(i.b)("inlineCode",{parentName:"p"},"clean")," flag is ",Object(i.b)("inlineCode",{parentName:"p"},"true"),", all previously deployed web content is deleted prior to deploying new content. The default is ",Object(i.b)("inlineCode",{parentName:"p"},"false"),", in which case previously deployed web content is allowed to remain."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Tip:")," A top-level ",Object(i.b)("inlineCode",{parentName:"p"},"cleanNamespace: true")," designation clears both web content and actions prior to a new deployment."),Object(i.b)("h5",{id:"configure-behavior-when-the-url-denotes-a-directory"},"Configure behavior when the URL denotes a directory"),Object(i.b)("p",null,"You can configure which file is served when a URL denotes a directory. By default, the file ",Object(i.b)("em",{parentName:"p"},"index.html")," is served, but you can change the file name with the ",Object(i.b)("inlineCode",{parentName:"p"},"mainPageSuffix")," flag."),Object(i.b)("p",null,"In the bucket example above, the file that is opened when the prefix path is ",Object(i.b)("inlineCode",{parentName:"p"},"chatroom")," is ",Object(i.b)("em",{parentName:"p"},"chatroom.html"),"."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Notes:")),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"The deployer doesn\u2019t generate ",Object(i.b)("em",{parentName:"li"},"index.html")," or any other file you name here. You must provide the file as part of the web content."),Object(i.b)("li",{parentName:"ul"},"The ",Object(i.b)("inlineCode",{parentName:"li"},"mainPageSuffix")," option is global to the namespace, so if you deploy multiple web folders into the same namespace using separate projects, either use the same values in all such projects or specify them in only one of the projects. You can obtain more than one namespace from Nimbella to deal with any conflicts that are otherwise hard to resolve.")),Object(i.b)("h5",{id:"specify-the-page-for-a-404-error"},"Specify the page for a 404 error"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"notFoundPage")," option nominates a web page to be used for a URL that does not match any content. The designated page is returned with every 404 Not Found error. If you don\u2019t specify ",Object(i.b)("inlineCode",{parentName:"p"},"notFoundPage"),", the default is ",Object(i.b)("em",{parentName:"p"},"404.html"),"."),Object(i.b)("p",null,"Nimbella places its own ",Object(i.b)("em",{parentName:"p"},"404.html")," at the root of every namespace and preserves an existing file by that name when deleting web content from the namespace. You can overwrite the provided ",Object(i.b)("em",{parentName:"p"},"404.html")," or leave it there and use a different name for a custom Not Found page. The advantage of using a custom page is that you can easily revert to the Nimbella-provided one by removing the ",Object(i.b)("inlineCode",{parentName:"p"},"notFoundPage")," directive."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," The ",Object(i.b)("inlineCode",{parentName:"p"},"notFoundPage")," option is global to the namespace, so if you deploy multiple web folders into the same namespace using separate projects, either use the same values in all such projects or specify them in only one of the projects. You can obtain more than one namespace from Nimbella to deal with any conflicts that are otherwise hard to resolve."),Object(i.b)("h5",{id:"strip-path-segments"},"Strip path segments"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"strip")," option removes path segments, and in this sense, it is the opposite of ",Object(i.b)("inlineCode",{parentName:"p"},"prefixPath"),", which adds path segments. The number value specifies the number of paths to strip."),Object(i.b)("p",null,"You can use both ",Object(i.b)("inlineCode",{parentName:"p"},"strip")," and ",Object(i.b)("inlineCode",{parentName:"p"},"prefixPath")," to remove existing segments and then add new ones. The ",Object(i.b)("inlineCode",{parentName:"p"},"strip")," option is most useful when you use a tool to generate web content because often the tool puts its output in a specific directory that you might not want in your deployed namespace. For an example, see ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"/docs/docs/building#configuration-example-for-web-content-generated-by-a-tool"}),"Example of a web directory with a tool that generates web content")),Object(i.b)("h5",{id:"specifying-cache-behavior"},"Specifying cache behavior"),Object(i.b)("p",null,"The ",Object(i.b)("inlineCode",{parentName:"p"},"useCache")," option, if set to ",Object(i.b)("inlineCode",{parentName:"p"},"true")," turns on CDN cacheing and other cacheing for the deployed web content.  When the value is false (the default), web content will be served with a ",Object(i.b)("inlineCode",{parentName:"p"},"Cache-Control")," header that suppresses cacheing."),Object(i.b)("h5",{id:"forcing-local-build-behavior"},"Forcing local build behavior"),Object(i.b)("p",null,"Use ",Object(i.b)("inlineCode",{parentName:"p"},"localBuild")," to force the web build (if any) to be local.  This flag is similar to the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#localBuild"}),"localBuild")," option for actions, except that it applies to the web build."),Object(i.b)("h5",{id:"forcing-remote-build-behavior"},"Forcing remote build behavior"),Object(i.b)("p",null,"Use ",Object(i.b)("inlineCode",{parentName:"p"},"remoteBuild")," to force the web build (if any) to be remote.  This flag is similar to the ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#remoteBuild"}),"remoteBuild")," option for actions, except that it applies to the web build.   Remote builds for web content are always run in the ",Object(i.b)("inlineCode",{parentName:"p"},"nodejs:default")," container.  There is no current mechanism to select a different runtime container."),Object(i.b)("h4",{id:"configuration-example-for-web-content-generated-by-a-tool"},"Configuration example for web content generated by a tool"),Object(i.b)("p",null,"Here\u2019s an example of a basic ",Object(i.b)("em",{parentName:"p"},"web")," directory structure when you use a tool to generate web content. Chances are the tool puts its output in a specific directory. Here\u2019s an example diagram of the ",Object(i.b)("em",{parentName:"p"},"web")," directory for an ",Object(i.b)("inlineCode",{parentName:"p"},"example4")," project, using React to generate the web content."),Object(i.b)("center",null,Object(i.b)("img",{src:"./fig7-nim-examples-project-chat-react-directory-structure.svg",height:"550"})),Object(i.b)("center",null,"**Figure 6: Project web directory structure for generated web content**"),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},"web")," directory contains a ",Object(i.b)("em",{parentName:"p"},".include")," file and some other files related to building not shown in the diagram. The ",Object(i.b)("em",{parentName:"p"},"public")," and ",Object(i.b)("em",{parentName:"p"},"src")," directories contain the source of the React web application. The ",Object(i.b)("em",{parentName:"p"},"build")," directory is generated by the React build and contains all of the content to be deployed."),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},".include")," file contains only one line:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"build\n")),Object(i.b)("p",null,"The ",Object(i.b)("em",{parentName:"p"},"project.yml")," file contains the following content:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"Bucket:\n  strip: 1\n")),Object(i.b)("p",null,"The strip option strips one path segment from the deployed web content. See ",Object(i.b)("a",Object(a.a)({parentName:"p"},{href:"#strip-path-segments"}),"Strip path segments"),"."),Object(i.b)("p",null,"Deploy as follows:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"> nim project deploy chat\nDeploying project '.../chat'\n  to namespace '...'\n  on host 'https://...nimbella.io'\nStarted running ./build.sh in chat/web\nFinished running ./build.sh in chat/web\n\nDeployed 25 web content items to\n  https://...nimbella.io\nDeployed actions:\n  - chatadmin/create\n  ...\n  - chatroom/postMessage\n")),Object(i.b)("h3",{id:"symbolic-variables"},"Symbolic variables"),Object(i.b)("p",null,"The configuration can contain symbolic variables of the form ",Object(i.b)("inlineCode",{parentName:"p"},"${SYMBOL}")," where ",Object(i.b)("inlineCode",{parentName:"p"},"SYMBOL")," is chosen by you. The substitutions for these variables are taken from the process environment or optionally from an environment file.  Leading and trailing whitespace is ignored, so ",Object(i.b)("inlineCode",{parentName:"p"},"${PASSWORD}")," and ",Object(i.b)("inlineCode",{parentName:"p"},"${ PASSWORD }")," or even"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"${\n   PASSWORD\n}\n")),Object(i.b)("p",null,"have the same meaning."),Object(i.b)("p",null,"The environment file typically takes the form of a properties file that consists of key-value pairs, as in the following example."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"USERID=jane\nPASSWORD=notmyactualpassword\n")),Object(i.b)("p",null,"The environment file can also be in JSON format as long as it contains a single object to be interpreted as a dictionary."),Object(i.b)("p",null,"You can specify the environment file explicitly on the command line, as in this example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"nim project deploy myProject --env test.env\n")),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," If there is a file named ",Object(i.b)("inlineCode",{parentName:"p"},".env")," located in the root of the project, it will be used as the environment file, and you don\u2019t need the ",Object(i.b)("inlineCode",{parentName:"p"},"--env")," option on the command line."),Object(i.b)("p",null,"Substitution occurs as follows:"),Object(i.b)("ul",null,Object(i.b)("li",{parentName:"ul"},"If the symbol matches the name of an environment variable, the value of that environment variable is substituted and the environment file, if any, is ignored."),Object(i.b)("li",{parentName:"ul"},"Otherwise, if there is an environment file and the symbol matches one of its keys, the value paired with that key is substituted."),Object(i.b)("li",{parentName:"ul"},"Otherwise, the symbol is undefined, resulting in an error indication from nim.")),Object(i.b)("h3",{id:"file-substitution"},"File substitution"),Object(i.b)("p",null,"File substitution is typically used to set environment, parameters or annotations on an action or package or to set the top-level parameters, such as the following:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"environment: ${<.environment}\nparameters: ${<.parameters}\nannotations: ${<.annotations}\n")),Object(i.b)("p",null,"That is, you can \u201cinline\u201d the contents of certain files in certain places in the configuration in ",Object(i.b)("em",{parentName:"p"},"project.yml"),". There are constraints on how file substitution can be used, as explained below."),Object(i.b)("p",null,"Where it is legal, you can request file inclusion by using the ",Object(i.b)("inlineCode",{parentName:"p"},"<")," modifier in what otherwise looks like a symbolic variable, for example:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"${<.extraConfig}\n")),Object(i.b)("p",null,"Substitute any valid absolute or relative file system path for ",Object(i.b)("inlineCode",{parentName:"p"},"extraConfig"),", providing the path denotes a file. Files are relative to the project directory."),Object(i.b)("p",null,"File substitution can only be used in places where the configuration expects a subdictionary, meaning a closed grouping of key-value pairs under a specific heading like ",Object(i.b)("inlineCode",{parentName:"p"},"parameters"),", ",Object(i.b)("inlineCode",{parentName:"p"},"annotations"),", or ",Object(i.b)("inlineCode",{parentName:"p"},"bucket"),". Here\u2019s an example of a closed grouping:"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters: ${<.parameters}\n  peerOfParameters:\n")),Object(i.b)("p",null,"The following example isn\u2019t a closed grouping.  Once you include a file to satisfy the contents of a heading you can't add to it."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters: ${<.parameters}\n    anotherParameter: value\n  # Will cause an error\n")),Object(i.b)("p",null,"The file whose contents are inlined must either contain JSON or be in the form of a properties file with key-value pairs. In other words, it takes the same form as the environment file used in symbol substitution. In fact, the properties file can be the same file as the environment file, but it doesn\u2019t have to be. If it is in the form of a properties file, it will be converted into a shallow dictionary with no nested subdictionaries for the purpose of inclusion. With JSON, you can escape this restriction and have a nested structure. Note that the file is not interpreted as YAML."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Warning:")," All inclusions are processed ",Object(i.b)("em",{parentName:"p"},"before")," the resulting YAML is parsed. For this reason, errors can be obscure when you violate the restrictions."),Object(i.b)("h3",{id:"dictionary-substitution"},"Dictionary substitution"),Object(i.b)("p",null,"Sometimes you may have a large number of parameters across the entire project, but it is wasteful to pass all parameters to all actions (which is what would happen if you used file substitution).  You can use a single environment file (specified on the command line or ",Object(i.b)("inlineCode",{parentName:"p"},".env")," in the project root) and dole out the appropriate parts of it on a per action basis like this."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters: $(\n    userid\n    password\n  )\n")),Object(i.b)("p",null,"Note the use of ",Object(i.b)("inlineCode",{parentName:"p"},"$( )")," rather than ",Object(i.b)("inlineCode",{parentName:"p"},"${ }"),".  Dictionary substitution is syntactic sugar for"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters:\n    userid: ${userid}\n    password: ${password}\n")),Object(i.b)("p",null,"The whitespace separation within the substitution is arbitrary and you could alternatively have used"),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters: $(userid password)\n")),Object(i.b)("p",null,"Single variables can also be used in the dictionary form."),Object(i.b)("pre",null,Object(i.b)("code",Object(a.a)({parentName:"pre"},{}),"  parameters: $(\n    password\n  )\n")),Object(i.b)("p",null,"It is important is that the initial token ",Object(i.b)("inlineCode",{parentName:"p"},"$(")," be placed somewhere where the YAML parser expects a subdictionary, the same rule as for file substitution."),Object(i.b)("p",null,Object(i.b)("strong",{parentName:"p"},"Note:")," As with file substitution, dictionary substitution can only be used where the configuration expects a subdictionary, and you can't add to it."))}s.isMDXComponent=!0},137:function(e,t,n){"use strict";n.d(t,"a",(function(){return p})),n.d(t,"b",(function(){return h}));var a=n(0),o=n.n(a);function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var a=Object.getOwnPropertySymbols(e);t&&(a=a.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,a)}return n}function c(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?r(Object(n),!0).forEach((function(t){i(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):r(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function l(e,t){if(null==e)return{};var n,a,o=function(e,t){if(null==e)return{};var n,a,o={},i=Object.keys(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||(o[n]=e[n]);return o}(e,t);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(e);for(a=0;a<i.length;a++)n=i[a],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(o[n]=e[n])}return o}var b=o.a.createContext({}),s=function(e){var t=o.a.useContext(b),n=t;return e&&(n="function"==typeof e?e(t):c(c({},t),e)),n},p=function(e){var t=s(e.components);return o.a.createElement(b.Provider,{value:t},e.children)},d={inlineCode:"code",wrapper:function(e){var t=e.children;return o.a.createElement(o.a.Fragment,{},t)}},m=o.a.forwardRef((function(e,t){var n=e.components,a=e.mdxType,i=e.originalType,r=e.parentName,b=l(e,["components","mdxType","originalType","parentName"]),p=s(n),m=a,h=p["".concat(r,".").concat(m)]||p[m]||d[m]||i;return n?o.a.createElement(h,c(c({ref:t},b),{},{components:n})):o.a.createElement(h,c({ref:t},b))}));function h(e,t){var n=arguments,a=t&&t.mdxType;if("string"==typeof e||a){var i=n.length,r=new Array(i);r[0]=m;var c={};for(var l in t)hasOwnProperty.call(t,l)&&(c[l]=t[l]);c.originalType=e,c.mdxType="string"==typeof e?e:a,r[1]=c;for(var b=2;b<i;b++)r[b]=n[b];return o.a.createElement.apply(null,r)}return o.a.createElement.apply(null,n)}m.displayName="MDXCreateElement"}}]);